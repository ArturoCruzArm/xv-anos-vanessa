<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Preparativos de la Quincea√±era - XV A√±os</title>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/admin.css">
    <link rel="stylesheet" href="css/servicios.css">
    <style>
        .prep-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.1);
        }
        .prep-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #ecf0f1;
        }
        .prep-header .icon-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
        }
        .prep-header h2 {
            margin: 0;
            color: #2c3e50;
        }
        .prep-header small {
            color: #7f8c8d;
        }
        .checklist {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .checklist li {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            padding: 15px;
            margin: 10px 0;
            background: #f8f9fa;
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        .checklist li:hover {
            background: #e8f4fc;
            transform: translateX(5px);
        }
        .checklist li.completed {
            background: #e8f8f5;
            text-decoration: line-through;
            opacity: 0.7;
        }
        .check-box {
            width: 28px;
            height: 28px;
            border: 3px solid #3498db;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.3s ease;
        }
        .check-box:hover {
            background: #3498db;
            color: white;
        }
        .check-box.checked {
            background: #27ae60;
            border-color: #27ae60;
            color: white;
        }
        .item-content {
            flex: 1;
        }
        .item-content strong {
            display: block;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        .item-content small {
            color: #7f8c8d;
        }
        .item-category {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: bold;
            text-transform: uppercase;
        }
        .cat-vestuario { background: #ffeaa7; color: #d68910; }
        .cat-accesorios { background: #dfe6e9; color: #636e72; }
        .cat-belleza { background: #fab1a0; color: #d63031; }
        .cat-documentos { background: #74b9ff; color: #0984e3; }
        .cat-otros { background: #a29bfe; color: #6c5ce7; }
        .date-badge {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px 25px;
            border-radius: 15px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            font-weight: bold;
        }
        .add-item-form {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px dashed #dfe6e9;
        }
        .add-item-form input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #dfe6e9;
            border-radius: 10px;
            font-size: 1rem;
        }
        .add-item-form button {
            padding: 12px 25px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        .add-item-form button:hover {
            background: #2980b9;
            transform: scale(1.05);
        }
        .stats-bar {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .stat-item {
            background: #f8f9fa;
            padding: 15px 20px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .stat-item i {
            font-size: 1.5rem;
            color: #3498db;
        }
        .stat-item span {
            font-weight: bold;
            font-size: 1.2rem;
        }
        .notes-area {
            margin-top: 20px;
            padding: 20px;
            background: #fff9e6;
            border-radius: 15px;
            border-left: 5px solid #f39c12;
        }
        .notes-area h4 {
            color: #f39c12;
            margin: 0 0 10px 0;
        }
        .notes-area textarea {
            width: 100%;
            min-height: 100px;
            padding: 15px;
            border: 2px solid #f9e79f;
            border-radius: 10px;
            font-family: inherit;
            resize: vertical;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <a href="admin.html" class="btn-back"><i class="fas fa-arrow-left"></i> Volver al Panel</a>

        <header class="service-header" style="background: linear-gradient(135deg, #fd79a8, #e84393);">
            <div class="service-icon"><i class="fas fa-crown"></i></div>
            <h1>Preparativos de <span id="quinceName">la Quincea√±era</span></h1>
            <p>Todo lo que necesitas para la sesi√≥n previa y el d√≠a del evento</p>
        </header>

        <!-- Info de la quincea√±era -->
        <div class="prep-section">
            <div class="stats-bar">
                <div class="stat-item">
                    <i class="fas fa-tshirt"></i>
                    <div>
                        <small>Color del Vestido</small>
                        <span id="dressColor">Cargando...</span>
                    </div>
                </div>
                <div class="stat-item">
                    <i class="fas fa-music"></i>
                    <div>
                        <small>Estilo Favorito</small>
                        <span id="favStyle">Cargando...</span>
                    </div>
                </div>
                <div class="stat-item">
                    <i class="fas fa-calendar"></i>
                    <div>
                        <small>Fecha del Evento</small>
                        <span id="eventDate">Cargando...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- SESI√ìN PREVIA -->
        <div class="prep-section">
            <div class="prep-header">
                <div class="icon-circle" style="background: linear-gradient(135deg, #74b9ff, #0984e3);">
                    <i class="fas fa-camera"></i>
                </div>
                <div>
                    <h2>Sesi√≥n Fotogr√°fica Previa</h2>
                    <small id="sessionDate">Aproximadamente 1 mes antes del evento</small>
                </div>
            </div>

            <div class="date-badge">
                <i class="fas fa-calendar-alt"></i>
                <span>Fecha por definir (Marzo 2026 aproximadamente)</span>
            </div>

            <h3><i class="fas fa-list-check"></i> Lista de preparativos para la sesi√≥n</h3>
            <ul class="checklist" id="sessionChecklist">
                <!-- Se carga din√°micamente -->
            </ul>

            <div class="add-item-form">
                <input type="text" id="newSessionItem" placeholder="Agregar nuevo art√≠culo...">
                <button onclick="addItem('session')"><i class="fas fa-plus"></i> Agregar</button>
            </div>

            <div class="notes-area">
                <h4><i class="fas fa-sticky-note"></i> Notas para la Sesi√≥n</h4>
                <textarea id="sessionNotes" placeholder="Escribe aqu√≠ notas importantes para la sesi√≥n previa..."></textarea>
            </div>
        </div>

        <!-- D√çA DEL EVENTO -->
        <div class="prep-section">
            <div class="prep-header">
                <div class="icon-circle" style="background: linear-gradient(135deg, #fd79a8, #e84393);">
                    <i class="fas fa-star"></i>
                </div>
                <div>
                    <h2>D√≠a del Evento</h2>
                    <small>11 de Abril de 2026</small>
                </div>
            </div>

            <div class="date-badge">
                <i class="fas fa-calendar-star"></i>
                <span id="mainEventDate">S√°bado, 11 de Abril de 2026</span>
            </div>

            <h3><i class="fas fa-list-check"></i> Lista de preparativos para el gran d√≠a</h3>
            <ul class="checklist" id="eventChecklist">
                <!-- Se carga din√°micamente -->
            </ul>

            <div class="add-item-form">
                <input type="text" id="newEventItem" placeholder="Agregar nuevo art√≠culo...">
                <button onclick="addItem('event')"><i class="fas fa-plus"></i> Agregar</button>
            </div>

            <div class="notes-area">
                <h4><i class="fas fa-sticky-note"></i> Notas para el D√≠a del Evento</h4>
                <textarea id="eventNotes" placeholder="Escribe aqu√≠ notas importantes para el d√≠a del evento..."></textarea>
            </div>
        </div>

        <!-- Botones de acci√≥n -->
        <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 30px;">
            <button onclick="saveAllData()" class="btn-save" style="flex: 1; min-width: 200px;">
                <i class="fas fa-save"></i> Guardar Todo
            </button>
            <button onclick="sendViaWhatsApp()" style="flex: 1; min-width: 200px; padding: 15px 25px; background: #25D366; color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 1rem;">
                <i class="fab fa-whatsapp"></i> Enviar por WhatsApp
            </button>
        </div>
    </div>

    <script src="js/data-loader.js"></script>
    <script src="js/data-manager.js"></script>
    <script>
        // Listas predeterminadas
        const defaultSessionItems = [
            { id: 1, text: "Vestido de sesi√≥n (puede ser diferente al del evento)", category: "vestuario", completed: false },
            { id: 2, text: "Zapatos c√≥modos para la sesi√≥n", category: "vestuario", completed: false },
            { id: 3, text: "Accesorios: aretes, collar, pulsera", category: "accesorios", completed: false },
            { id: 4, text: "Corona o tiara (si aplica)", category: "accesorios", completed: false },
            { id: 5, text: "Maquillaje b√°sico o ir sin maquillaje (el estilista se encarga)", category: "belleza", completed: false },
            { id: 6, text: "Cabello limpio y sin productos", category: "belleza", completed: false },
            { id: 7, text: "Ramo de flores (opcional para fotos)", category: "accesorios", completed: false },
            { id: 8, text: "Zapatos de tac√≥n para algunas fotos", category: "vestuario", completed: false },
            { id: 9, text: "Cambio de ropa casual para fotos informales", category: "vestuario", completed: false },
            { id: 10, text: "Objetos personales importantes (mu√±eca de XV, biblia, rosario)", category: "otros", completed: false }
        ];

        const defaultEventItems = [
            { id: 1, text: "Vestido de XV a√±os color DORADO", category: "vestuario", completed: false },
            { id: 2, text: "Zapatillas de cristal / tac√≥n principal", category: "vestuario", completed: false },
            { id: 3, text: "Zapatos c√≥modos para bailar (para cambio)", category: "vestuario", completed: false },
            { id: 4, text: "Ropa interior adecuada para el vestido", category: "vestuario", completed: false },
            { id: 5, text: "Corona / tiara", category: "accesorios", completed: false },
            { id: 6, text: "Aretes, collar y pulsera", category: "accesorios", completed: false },
            { id: 7, text: "Anillo de XV a√±os", category: "accesorios", completed: false },
            { id: 8, text: "Ramo de flores para la misa", category: "accesorios", completed: false },
            { id: 9, text: "√öltima mu√±eca", category: "otros", completed: false },
            { id: 10, text: "Coj√≠n para los s√≠mbolos (zapatilla, anillo, corona)", category: "otros", completed: false },
            { id: 11, text: "Biblia y rosario", category: "otros", completed: false },
            { id: 12, text: "Vela de XV a√±os", category: "otros", completed: false },
            { id: 13, text: "Kit de emergencia (hilos, agujas, safety pins)", category: "otros", completed: false },
            { id: 14, text: "Kit de maquillaje para retoques", category: "belleza", completed: false },
            { id: 15, text: "Perfume", category: "belleza", completed: false },
            { id: 16, text: "Desodorante", category: "belleza", completed: false },
            { id: 17, text: "Toallitas h√∫medas", category: "belleza", completed: false },
            { id: 18, text: "Pa√±uelos de papel", category: "otros", completed: false },
            { id: 19, text: "Pastillas para el dolor (por si acaso)", category: "otros", completed: false },
            { id: 20, text: "Cargador de celular", category: "otros", completed: false },
            { id: 21, text: "Cambio de ropa para despu√©s del evento", category: "vestuario", completed: false },
            { id: 22, text: "Dinero en efectivo para emergencias", category: "documentos", completed: false }
        ];

        const STORAGE_KEY = 'xv-barbara-preparativos';
        let preparativosData = {
            session: { items: [], notes: '' },
            event: { items: [], notes: '' }
        };

        document.addEventListener('DOMContentLoaded', async () => {
            // Cargar datos del evento
            const eventoData = await dataLoader.loadJSON('data/data.json');

            if (eventoData) {
                document.getElementById('quinceName').textContent = eventoData.quincea√±era?.nombre || 'la Quincea√±era';
                document.getElementById('dressColor').textContent = eventoData.quincea√±era?.vestido?.color?.toUpperCase() || 'Por definir';
                document.getElementById('favStyle').textContent = eventoData.quincea√±era?.estiloFavorito || eventoData.quincea√±era?.gustosMusicales?.[0] || 'Por definir';

                if (eventoData.fechas?.evento) {
                    const fecha = new Date(eventoData.fechas.evento + 'T12:00:00');
                    const opciones = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                    document.getElementById('eventDate').textContent = `${eventoData.fechas.diaEvento} Abril 2026`;
                    document.getElementById('mainEventDate').textContent = fecha.toLocaleDateString('es-MX', opciones);
                }

                // Actualizar el texto del vestido
                if (eventoData.quincea√±era?.vestido?.color) {
                    const vestidoItem = defaultEventItems.find(i => i.text.includes('Vestido de XV'));
                    if (vestidoItem) {
                        vestidoItem.text = `Vestido de XV a√±os color ${eventoData.quincea√±era.vestido.color.toUpperCase()}`;
                    }
                }
            }

            // Cargar datos guardados o usar predeterminados
            loadData();
        });

        function loadData() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                preparativosData = JSON.parse(saved);
            } else {
                preparativosData = {
                    session: { items: [...defaultSessionItems], notes: '' },
                    event: { items: [...defaultEventItems], notes: '' }
                };
            }

            renderChecklist('session');
            renderChecklist('event');

            document.getElementById('sessionNotes').value = preparativosData.session.notes || '';
            document.getElementById('eventNotes').value = preparativosData.event.notes || '';
        }

        function renderChecklist(type) {
            const container = document.getElementById(type === 'session' ? 'sessionChecklist' : 'eventChecklist');
            const items = preparativosData[type].items;

            let html = '';
            items.forEach(item => {
                html += `
                    <li class="${item.completed ? 'completed' : ''}">
                        <div class="check-box ${item.completed ? 'checked' : ''}" onclick="toggleItem('${type}', ${item.id})">
                            ${item.completed ? '<i class="fas fa-check"></i>' : ''}
                        </div>
                        <div class="item-content">
                            <strong>${item.text}</strong>
                        </div>
                        <span class="item-category cat-${item.category}">${item.category}</span>
                        <button onclick="removeItem('${type}', ${item.id})" style="background: none; border: none; color: #e74c3c; cursor: pointer; padding: 5px;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </li>
                `;
            });

            container.innerHTML = html;
        }

        function toggleItem(type, id) {
            const item = preparativosData[type].items.find(i => i.id === id);
            if (item) {
                item.completed = !item.completed;
                saveData();
                renderChecklist(type);
            }
        }

        function addItem(type) {
            const inputId = type === 'session' ? 'newSessionItem' : 'newEventItem';
            const input = document.getElementById(inputId);
            const text = input.value.trim();

            if (!text) return;

            const maxId = Math.max(...preparativosData[type].items.map(i => i.id), 0);
            preparativosData[type].items.push({
                id: maxId + 1,
                text: text,
                category: 'otros',
                completed: false
            });

            input.value = '';
            saveData();
            renderChecklist(type);
        }

        function removeItem(type, id) {
            if (confirm('¬øEliminar este art√≠culo?')) {
                preparativosData[type].items = preparativosData[type].items.filter(i => i.id !== id);
                saveData();
                renderChecklist(type);
            }
        }

        function saveData() {
            preparativosData.session.notes = document.getElementById('sessionNotes').value;
            preparativosData.event.notes = document.getElementById('eventNotes').value;
            localStorage.setItem(STORAGE_KEY, JSON.stringify(preparativosData));
        }

        function saveAllData() {
            saveData();
            alert('Datos guardados correctamente');
        }

        function sendViaWhatsApp() {
            saveData();

            let message = '*PREPARATIVOS XV A√ëOS*\n\n';

            // Sesi√≥n previa
            message += '*SESI√ìN FOTOGR√ÅFICA PREVIA*\n';
            preparativosData.session.items.forEach(item => {
                message += `${item.completed ? '‚úÖ' : '‚¨ú'} ${item.text}\n`;
            });
            if (preparativosData.session.notes) {
                message += `\nüìù Notas: ${preparativosData.session.notes}\n`;
            }

            message += '\n*D√çA DEL EVENTO*\n';
            preparativosData.event.items.forEach(item => {
                message += `${item.completed ? '‚úÖ' : '‚¨ú'} ${item.text}\n`;
            });
            if (preparativosData.event.notes) {
                message += `\nüìù Notas: ${preparativosData.event.notes}\n`;
            }

            const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }

        // Auto-guardar al escribir en las notas
        document.getElementById('sessionNotes').addEventListener('input', () => setTimeout(saveData, 500));
        document.getElementById('eventNotes').addEventListener('input', () => setTimeout(saveData, 500));

        // Permitir agregar con Enter
        document.getElementById('newSessionItem').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') addItem('session');
        });
        document.getElementById('newEventItem').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') addItem('event');
        });
    </script>
</body>
</html>
